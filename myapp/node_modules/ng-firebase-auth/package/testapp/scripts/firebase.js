'use strict';

/**
 * @ngInject
 * @ngdoc object
 * @name app.service:Firebase
 * @description This service is for reference to the Firebase application
 */
module.exports = function($firebase, $firebaseAuth, $rootScope) {

  /**
   * @description Reference to service
   * @type {Object}
   */
  var service = {};

  /**
   * @desc Firebase class
   * @type {Firebase}
   */
  service.ref = new Firebase("https://brilliant-heat-2404.firebaseio.com/");

  /**
   * @description Check if user is logged in
   * @param  {Object} authData User Firebase profile
   * @return {Object} service
   */
  service.ref.onAuth(function(authData) {
    if (authData) {
      service.user = authData;
    } else {
      service.user = null;
    }

    $rootScope.$broadcast('user::authchange');
    return service;
  });

  /**
   * @description Create an AngularFire reference to the data
   * @type {Object}
   */
  service.sync = $firebase(service.ref);

  /**
   * @description Create an AngularFire auth reference
   * @type {Object}
   */
  service.auth = $firebaseAuth(service.ref);

  return service;
};
